<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8"/>
	<meta name="description" content="Data Visualisation Project"/>
	<meta name="keywords" content="HTML, CSS"/>
	<meta name="author"	content="Your name here"/>
	<link rel="stylesheet" type="text/css" href="style/style.css"/>
	<script src="https://d3js.org/d3.v6.min.js"></script>
	<title>Sarawak Visitor Arrivals</title>
</head>

<body>
	<h1 id="center">Sarawak Visitors Arrivals</h1>

	<button id="prevYear">Previous</button>
	<span id="currentYear"></span>
	<button id="nextYear">Next</button>

	<div id="tooltip"></div>
	
	<script>
		var w = 1500;
		var h = 800;

		var projection = d3.geoMercator()
			.translate([w / 2, h / 2])
			.scale(135);

		var path = d3.geoPath()
			.projection(projection);

		var svg = d3.select("body")
			.append("svg")
			.attr("width", w)
			.attr("height", h)
			.attr("fill", "gold");

		var tooltip = d3.select("#tooltip");

		var currentYearIndex = 0; // To keep track of the current year index
		var years = []; // Array to store the years from the data

		function updateMapForYear(year, data) {
			// Add this line for debugging
			console.log("Data for year", year, ":", data);

			// Update your map based on the year and data
			// This might involve filtering data and redrawing parts of the map
			d3.select("#currentYear")
				.text(year)
				.style("color", "white"); // Update the current year display

			// Extract country-wise visitor data and calculate the total visitors
			var countryVisitorData = {};
			data.features.forEach(function (d) {
				var countryName = d.properties.name;
				var visitors = parseFloat(d.properties.G_Total);

				// Summing up visitor data for each country
				countryVisitorData[countryName] = visitors;
			});

			// Color the countries based on the total visitors
			svg.selectAll(".country")
				.data(data.features)
				.style("fill", function (d) {
					var countryName = d.properties.name;
					var visitors = countryVisitorData[countryName];

					// Use a color scale or logic based on visitor data to determine the fill color
					// Example: Using a color scale
					var colorScale = d3.scaleLinear()
						.domain([0, d3.max(Object.values(countryVisitorData))])
						.range(["white", "blue"]);

					return colorScale(visitors);
				});
		}

		// Function to handle year navigation
		function changeYear(direction) {
			if (direction === 'next' && currentYearIndex < years.length - 1) {
				currentYearIndex++;
			} else if (direction === 'prev' && currentYearIndex > 0) {
				currentYearIndex--;
			}

			var currentYear = years[currentYearIndex];
			d3.csv("Sarawak Visitor Arrivals " + currentYear + ".csv").then(function (data) {
				updateMapForYear(currentYear, data);
			});
		}

		// Setting up event listeners for buttons
		d3.select("#prevYear").on("click", function () { changeYear('prev'); });
		d3.select("#nextYear").on("click", function () { changeYear('next'); });

		// Load your data from CSV files
		var files = ["2017", "2018", "2019", "2020", "2021"]; // Update with your file names
		Promise.all(files.map(file => d3.csv("Sarawak_Visitor_Arrivals_" + file + ".csv")))
			.then(function (dataArray) {
				// Extract years from the data and sort them
				years = files;

				// Initialize the map with the first year's data
				updateMapForYear(years[currentYearIndex], dataArray[currentYearIndex]);
			});

		d3.json("world_map.json").then(function (json) {
			svg.selectAll("path")
				.data(json.features)
				.enter()
				.append("path")
				.attr("d", path)
				.attr("class", "country")
				.on("mouseover", function (event, d) {
					var centroid = path.centroid(d);
					var xPosition = centroid[0];
					var yPosition = centroid[1];

					tooltip.style("display", "block")
						.html(d.properties.name)
						.style("left", xPosition + "px")
						.style("top", yPosition + "px");

					d3.select(this)
						.style("fill", "orange");
				})
				.on("mouseout", function (d) {
					tooltip.style("display", "none");
					d3.select(this)
						.style("fill", "gold");
				})
				.on("click", function (d) {
					console.log("Clicked on", d.properties.name);
				});
		});
	</script>
</body>
</html>
	
	